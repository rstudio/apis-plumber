<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Creating APIs in R with Plumber</title>
  <meta name="description" content="Use the plumber R package to create HTTP APIs in R.">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Creating APIs in R with Plumber" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="./files/images/cover.jpg" />
  <meta property="og:description" content="Use the plumber R package to create HTTP APIs in R." />
  <meta name="github-repo" content="trestletech/apis-plumber" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Creating APIs in R with Plumber" />
  
  <meta name="twitter:description" content="Use the plumber R package to create HTTP APIs in R." />
  <meta name="twitter:image" content="./files/images/cover.jpg" />

<meta name="author" content="Jeff Allen">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="./files/images/apple-icon-152x152.png">
  <link rel="shortcut icon" href="./files/images/favicon.png" type="image/x-icon">
<link rel="prev" href="hosting.html">
<link rel="next" href="tips-tricks.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#web-apis"><i class="fa fa-check"></i><b>1.1</b> Web APIs</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="quickstart.html"><a href="quickstart.html"><i class="fa fa-check"></i><b>2</b> Quickstart</a><ul>
<li class="chapter" data-level="2.1" data-path="quickstart.html"><a href="quickstart.html#specifying-the-inputs"><i class="fa fa-check"></i><b>2.1</b> Specifying the Inputs</a></li>
<li class="chapter" data-level="2.2" data-path="quickstart.html"><a href="quickstart.html#customizing-the-output"><i class="fa fa-check"></i><b>2.2</b> Customizing The Output</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="routing-and-input.html"><a href="routing-and-input.html"><i class="fa fa-check"></i><b>3</b> Routing &amp; Input</a><ul>
<li class="chapter" data-level="3.1" data-path="routing-and-input.html"><a href="routing-and-input.html#endpoints"><i class="fa fa-check"></i><b>3.1</b> Endpoints</a></li>
<li class="chapter" data-level="3.2" data-path="routing-and-input.html"><a href="routing-and-input.html#filters"><i class="fa fa-check"></i><b>3.2</b> Filters</a><ul>
<li class="chapter" data-level="3.2.1" data-path="routing-and-input.html"><a href="routing-and-input.html#forward-to-another-handler"><i class="fa fa-check"></i><b>3.2.1</b> Forward to Another Handler</a></li>
<li class="chapter" data-level="3.2.2" data-path="routing-and-input.html"><a href="routing-and-input.html#return-a-response"><i class="fa fa-check"></i><b>3.2.2</b> Return a Response</a></li>
<li class="chapter" data-level="3.2.3" data-path="routing-and-input.html"><a href="routing-and-input.html#throw-an-error"><i class="fa fa-check"></i><b>3.2.3</b> Throw an Error</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="routing-and-input.html"><a href="routing-and-input.html#dynamic-routes"><i class="fa fa-check"></i><b>3.3</b> Dynamic Routes</a></li>
<li class="chapter" data-level="3.4" data-path="routing-and-input.html"><a href="routing-and-input.html#typed-dynamic-routes"><i class="fa fa-check"></i><b>3.4</b> Typed Dynamic Routes</a></li>
<li class="chapter" data-level="3.5" data-path="routing-and-input.html"><a href="routing-and-input.html#static-file-handler"><i class="fa fa-check"></i><b>3.5</b> Static File Handler</a></li>
<li class="chapter" data-level="3.6" data-path="routing-and-input.html"><a href="routing-and-input.html#input-handling"><i class="fa fa-check"></i><b>3.6</b> Input Handling</a><ul>
<li class="chapter" data-level="3.6.1" data-path="routing-and-input.html"><a href="routing-and-input.html#the-request-object"><i class="fa fa-check"></i><b>3.6.1</b> The Request Object</a></li>
<li class="chapter" data-level="3.6.2" data-path="routing-and-input.html"><a href="routing-and-input.html#query-strings"><i class="fa fa-check"></i><b>3.6.2</b> Query Strings</a></li>
<li class="chapter" data-level="3.6.3" data-path="routing-and-input.html"><a href="routing-and-input.html#request-body"><i class="fa fa-check"></i><b>3.6.3</b> Request Body</a></li>
<li class="chapter" data-level="3.6.4" data-path="routing-and-input.html"><a href="routing-and-input.html#read-cookies"><i class="fa fa-check"></i><b>3.6.4</b> Cookies</a></li>
<li class="chapter" data-level="3.6.5" data-path="routing-and-input.html"><a href="routing-and-input.html#headers"><i class="fa fa-check"></i><b>3.6.5</b> Headers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rendering-and-output.html"><a href="rendering-and-output.html"><i class="fa fa-check"></i><b>4</b> Rendering Output</a><ul>
<li class="chapter" data-level="4.1" data-path="rendering-and-output.html"><a href="rendering-and-output.html#response-object"><i class="fa fa-check"></i><b>4.1</b> The Response Object</a></li>
<li class="chapter" data-level="4.2" data-path="rendering-and-output.html"><a href="rendering-and-output.html#serializers"><i class="fa fa-check"></i><b>4.2</b> Serializers</a><ul>
<li class="chapter" data-level="4.2.1" data-path="rendering-and-output.html"><a href="rendering-and-output.html#bypassing-serialization"><i class="fa fa-check"></i><b>4.2.1</b> Bypassing Serialization</a></li>
<li class="chapter" data-level="4.2.2" data-path="rendering-and-output.html"><a href="rendering-and-output.html#boxed-vs-unboxed-json"><i class="fa fa-check"></i><b>4.2.2</b> Boxed vs Unboxed JSON</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rendering-and-output.html"><a href="rendering-and-output.html#error-handling"><i class="fa fa-check"></i><b>4.3</b> Error Handling</a></li>
<li class="chapter" data-level="4.4" data-path="rendering-and-output.html"><a href="rendering-and-output.html#custom-serializers"><i class="fa fa-check"></i><b>4.4</b> Custom Serializers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="runtime.html"><a href="runtime.html"><i class="fa fa-check"></i><b>5</b> Runtime</a><ul>
<li class="chapter" data-level="5.1" data-path="runtime.html"><a href="runtime.html#execution-model"><i class="fa fa-check"></i><b>5.1</b> Execution Model</a></li>
<li class="chapter" data-level="5.2" data-path="runtime.html"><a href="runtime.html#environments"><i class="fa fa-check"></i><b>5.2</b> Environments</a></li>
<li class="chapter" data-level="5.3" data-path="runtime.html"><a href="runtime.html#performance-request-processing"><i class="fa fa-check"></i><b>5.3</b> Performance &amp; Request Processing</a></li>
<li class="chapter" data-level="5.4" data-path="runtime.html"><a href="runtime.html#managing-state"><i class="fa fa-check"></i><b>5.4</b> Managing State</a><ul>
<li class="chapter" data-level="5.4.1" data-path="runtime.html"><a href="runtime.html#in-memory"><i class="fa fa-check"></i><b>5.4.1</b> In-Memory</a></li>
<li class="chapter" data-level="5.4.2" data-path="runtime.html"><a href="runtime.html#file-system"><i class="fa fa-check"></i><b>5.4.2</b> File System</a></li>
<li class="chapter" data-level="5.4.3" data-path="runtime.html"><a href="runtime.html#state-cookies"><i class="fa fa-check"></i><b>5.4.3</b> Cookies</a></li>
<li class="chapter" data-level="5.4.4" data-path="runtime.html"><a href="runtime.html#external-data-store"><i class="fa fa-check"></i><b>5.4.4</b> External Data Store</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="security.html"><a href="security.html"><i class="fa fa-check"></i><b>6</b> Security</a><ul>
<li class="chapter" data-level="6.1" data-path="security.html"><a href="security.html#networking"><i class="fa fa-check"></i><b>6.1</b> Networking &amp; Firewalls</a></li>
<li class="chapter" data-level="6.2" data-path="security.html"><a href="security.html#dos"><i class="fa fa-check"></i><b>6.2</b> Denial Of Service (DoS)</a></li>
<li class="chapter" data-level="6.3" data-path="security.html"><a href="security.html#sanitization"><i class="fa fa-check"></i><b>6.3</b> Sanitization &amp; Injection</a></li>
<li class="chapter" data-level="6.4" data-path="security.html"><a href="security.html#cross-origin-resource-sharing-cors"><i class="fa fa-check"></i><b>6.4</b> Cross-Origin Resource Sharing (CORS)</a></li>
<li class="chapter" data-level="6.5" data-path="security.html"><a href="security.html#cross-site-request-forgery-csrf-or-xsrf"><i class="fa fa-check"></i><b>6.5</b> Cross-Site Request Forgery (CSRF, or XSRF)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="hosting.html"><a href="hosting.html"><i class="fa fa-check"></i><b>7</b> Hosting</a><ul>
<li class="chapter" data-level="7.1" data-path="hosting.html"><a href="hosting.html#digitalocean"><i class="fa fa-check"></i><b>7.1</b> DigitalOcean</a></li>
<li class="chapter" data-level="7.2" data-path="hosting.html"><a href="hosting.html#rstudio-connect"><i class="fa fa-check"></i><b>7.2</b> RStudio Connect</a></li>
<li class="chapter" data-level="7.3" data-path="hosting.html"><a href="hosting.html#docker"><i class="fa fa-check"></i><b>7.3</b> Docker (Basic)</a><ul>
<li class="chapter" data-level="7.3.1" data-path="hosting.html"><a href="hosting.html#default-dockerfile"><i class="fa fa-check"></i><b>7.3.1</b> Default Dockerfile</a></li>
<li class="chapter" data-level="7.3.2" data-path="hosting.html"><a href="hosting.html#custom-dockerfiles"><i class="fa fa-check"></i><b>7.3.2</b> Custom Dockerfiles</a></li>
<li class="chapter" data-level="7.3.3" data-path="hosting.html"><a href="hosting.html#automatically-run-on-restart"><i class="fa fa-check"></i><b>7.3.3</b> Automatically Run on Restart</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="hosting.html"><a href="hosting.html#docker-advanced"><i class="fa fa-check"></i><b>7.4</b> Docker (Advanced)</a><ul>
<li class="chapter" data-level="7.4.1" data-path="hosting.html"><a href="hosting.html#multiple-plumber-applications"><i class="fa fa-check"></i><b>7.4.1</b> Multiple Plumber Applications</a></li>
<li class="chapter" data-level="7.4.2" data-path="hosting.html"><a href="hosting.html#multiple-applications-on-one-port"><i class="fa fa-check"></i><b>7.4.2</b> Multiple Applications on One Port</a></li>
<li class="chapter" data-level="7.4.3" data-path="hosting.html"><a href="hosting.html#load-balancing"><i class="fa fa-check"></i><b>7.4.3</b> Load Balancing</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="hosting.html"><a href="hosting.html#pm2"><i class="fa fa-check"></i><b>7.5</b> pm2</a><ul>
<li class="chapter" data-level="7.5.1" data-path="hosting.html"><a href="hosting.html#server-deployment-and-preparation"><i class="fa fa-check"></i><b>7.5.1</b> Server Deployment and Preparation</a></li>
<li class="chapter" data-level="7.5.2" data-path="hosting.html"><a href="hosting.html#install-pm2"><i class="fa fa-check"></i><b>7.5.2</b> Install pm2</a></li>
<li class="chapter" data-level="7.5.3" data-path="hosting.html"><a href="hosting.html#wrap-your-plumber-file"><i class="fa fa-check"></i><b>7.5.3</b> Wrap Your Plumber File</a></li>
<li class="chapter" data-level="7.5.4" data-path="hosting.html"><a href="hosting.html#introduce-our-service-to-pm2"><i class="fa fa-check"></i><b>7.5.4</b> Introduce Our Service to pm2</a></li>
<li class="chapter" data-level="7.5.5" data-path="hosting.html"><a href="hosting.html#logs-and-management"><i class="fa fa-check"></i><b>7.5.5</b> Logs and Management</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="programmatic-usage.html"><a href="programmatic-usage.html"><i class="fa fa-check"></i><b>8</b> Programmatic Usage</a><ul>
<li class="chapter" data-level="8.1" data-path="programmatic-usage.html"><a href="programmatic-usage.html#creating-and-controlling-a-router"><i class="fa fa-check"></i><b>8.1</b> Creating and Controlling a Router</a></li>
<li class="chapter" data-level="8.2" data-path="programmatic-usage.html"><a href="programmatic-usage.html#defining-endpoints"><i class="fa fa-check"></i><b>8.2</b> Defining Endpoints</a></li>
<li class="chapter" data-level="8.3" data-path="programmatic-usage.html"><a href="programmatic-usage.html#defining-filters"><i class="fa fa-check"></i><b>8.3</b> Defining Filters</a></li>
<li class="chapter" data-level="8.4" data-path="programmatic-usage.html"><a href="programmatic-usage.html#registering-hooks-on-a-router-router-hooks"><i class="fa fa-check"></i><b>8.4</b> Registering Hooks on a Router {router-hooks}</a></li>
<li class="chapter" data-level="8.5" data-path="programmatic-usage.html"><a href="programmatic-usage.html#mount-static"><i class="fa fa-check"></i><b>8.5</b> Mounting &amp; Static File Routers</a></li>
<li class="chapter" data-level="8.6" data-path="programmatic-usage.html"><a href="programmatic-usage.html#customize-router"><i class="fa fa-check"></i><b>8.6</b> Customizing a Router</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tips-tricks.html"><a href="tips-tricks.html"><i class="fa fa-check"></i><b>9</b> Tips &amp; Tricks</a><ul>
<li class="chapter" data-level="9.1" data-path="tips-tricks.html"><a href="tips-tricks.html#debugging"><i class="fa fa-check"></i><b>9.1</b> Debugging</a><ul>
<li class="chapter" data-level="9.1.1" data-path="tips-tricks.html"><a href="tips-tricks.html#print-debugging"><i class="fa fa-check"></i><b>9.1.1</b> Print Debugging</a></li>
<li class="chapter" data-level="9.1.2" data-path="tips-tricks.html"><a href="tips-tricks.html#interactive-debugging"><i class="fa fa-check"></i><b>9.1.2</b> Interactive Debugging</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="tips-tricks.html"><a href="tips-tricks.html#testing"><i class="fa fa-check"></i><b>9.2</b> Testing</a></li>
<li class="chapter" data-level="9.3" data-path="tips-tricks.html"><a href="tips-tricks.html#organizing-large-applications"><i class="fa fa-check"></i><b>9.3</b> Organizing Large Applications</a></li>
<li class="chapter" data-level="9.4" data-path="tips-tricks.html"><a href="tips-tricks.html#swagger"><i class="fa fa-check"></i><b>9.4</b> Swagger</a></li>
<li class="chapter" data-level="9.5" data-path="tips-tricks.html"><a href="tips-tricks.html#performance"><i class="fa fa-check"></i><b>9.5</b> Performance</a></li>
<li class="chapter" data-level="9.6" data-path="tips-tricks.html"><a href="tips-tricks.html#cookies"><i class="fa fa-check"></i><b>9.6</b> Cookies</a><ul>
<li class="chapter" data-level="9.6.1" data-path="tips-tricks.html"><a href="tips-tricks.html#setting-cookies"><i class="fa fa-check"></i><b>9.6.1</b> Setting Unencrypted Cookies</a></li>
<li class="chapter" data-level="9.6.2" data-path="tips-tricks.html"><a href="tips-tricks.html#encrypted-cookies"><i class="fa fa-check"></i><b>9.6.2</b> Setting Encrypted Cookies</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="all-annotations.html"><a href="all-annotations.html"><i class="fa fa-check"></i><b>A</b> All Annotations</a></li>
<li class="chapter" data-level="B" data-path="plumber-0-4-0-migration-guide.html"><a href="plumber-0-4-0-migration-guide.html"><i class="fa fa-check"></i><b>B</b> Plumber 0.4.0 Migration Guide</a></li>
<li class="chapter" data-level="C" data-path="citations.html"><a href="citations.html"><i class="fa fa-check"></i><b>C</b> Citations</a></li>
<li class="divider"></li>
<li><a href="https://www.netlify.com" target="_blank">Site hosting from Netlify</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating APIs in R with Plumber</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="programmatic-usage" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Programmatic Usage</h1>
<p>Typically, users define APIs using the “annotations,” or special comments in their API source code. It is possible to define a Plumber API programmatically using the same underlying R6 objects that get created automatically when you define your API using annotations. Interacting with Plumber at this level can offer more control and specificity about how you want your API to behave.</p>
<div id="creating-and-controlling-a-router" class="section level2">
<h2><span class="header-section-number">8.1</span> Creating and Controlling a Router</h2>
<p>The centerpiece of Plumber is the router. Plumber routers are responsible for coordinating incoming requests from httpuv, dispatching the requests to the appropriate filters/endpoints, serializing the response, and handling errors that might pop up along the way. If you’ve been using annotations to define Plumber APIs, then you’ve already worked with Plumber routers as that’s what the <code>plumb()</code> command produces.</p>
<p>To instantiate a new Plumber router programmatically, you can call <code>plumber$new()</code>. This will return a blank Plumber router with no endpoints. You could call <code>run()</code> on the returned object to start the API, but it doesn’t know how to respond to any requests so any incoming traffic would get a <code>404</code> response. We’ll see momentarily how to add endpoints and filters onto this empty router. Alternatively, you can pass a file that contains your annotation-based Plumber API as the first parameter to create a router much like you do with <code>plumb()</code>.</p>
<p>Be aware that Plumber routers do come with a handful of filters pre-configured. These built-in filters are used to do things like process properties of the incoming request like its cookies, <code>POST</code> body, or query string. You can specify which filters you want in your new router by overriding the <code>filters</code> parameter when creating your new router.</p>
</div>
<div id="defining-endpoints" class="section level2">
<h2><span class="header-section-number">8.2</span> Defining Endpoints</h2>
<p>You can define endpoints on your router by using the <code>handle()</code> method. For instance, to define a Plumber API that response to <code>GET</code> requests on <code>/</code> and <code>POST</code> requests on <code>/submit</code>, you could use the following code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pr &lt;-<span class="st"> </span>plumber$<span class="kw">new</span>()
pr$<span class="kw">handle</span>(<span class="st">&quot;GET&quot;</span>, <span class="st">&quot;/&quot;</span>, function(req, res){
  <span class="co"># ...</span>
})

pr$<span class="kw">handle</span>(<span class="st">&quot;POST&quot;</span>, <span class="st">&quot;/submit&quot;</span>, function(req, res){
  <span class="co"># ...</span>
})</code></pre></div>
<p>The “handler” functions that you define in these <code>handle</code> calls are identical to the code you would have defined in your <code>plumber.R</code> file if you were using annotations to define your API.</p>
<p>The <code>handle()</code> method takes additional arguments that allow you to control nuanced behavior of the endpoint like which filter it might preempt or which serializer it should use. For instance, the following endpoint would use Plumber’s HTML serializer.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pr &lt;-<span class="st"> </span>plumber$<span class="kw">new</span>()
pr$<span class="kw">handle</span>(<span class="st">&quot;GET&quot;</span>, <span class="st">&quot;/&quot;</span>, function(){
  <span class="st">&quot;&lt;html&gt;&lt;h1&gt;Programmatic Plumber!&lt;/h1&gt;&lt;/html&gt;&quot;</span>
}, <span class="dt">serializer=</span>plumber::<span class="kw">serializer_html</span>())</code></pre></div>
</div>
<div id="defining-filters" class="section level2">
<h2><span class="header-section-number">8.3</span> Defining Filters</h2>
<p>Use the <code>filter()</code> method of a Plumber router to define a new filter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pr &lt;-<span class="st"> </span>plumber$<span class="kw">new</span>()

pr$<span class="kw">filter</span>(<span class="st">&quot;myFilter&quot;</span>, function(req){
  req$filtered &lt;-<span class="st"> </span><span class="ot">TRUE</span>
  <span class="kw">forward</span>()
})

pr$<span class="kw">handle</span>(<span class="st">&quot;GET&quot;</span>, <span class="st">&quot;/&quot;</span>, function(req){
  <span class="kw">paste</span>(<span class="st">&quot;Am I filtered?&quot;</span>, req$filtered)
})</code></pre></div>
<p>You can specify other options such as the serializer to use if the filter returns a value in the <code>filter()</code> method, as well.</p>
</div>
<div id="registering-hooks-on-a-router-router-hooks" class="section level2">
<h2><span class="header-section-number">8.4</span> Registering Hooks on a Router {router-hooks}</h2>
<p>Plumber routers support the notion of “hooks” that can be registered to execute some code at a particular point in the lifecycle of a request. Plumber routers currently support four hooks:</p>
<ul>
<li><code>preroute(data, req, res)</code></li>
<li><code>postroute(data, req, res, value)</code></li>
<li><code>preserialize(data, req, res, value)</code></li>
<li><code>postserialize(data, req, res, value)</code></li>
</ul>
<p>In all of the above you have access to a disposable environment in the <code>data</code> parameter that is created as a temporary data store for each request. Hooks can store temporary data in these hooks that can be reused by other hooks processing this same request.</p>
<p>One feature when defining hooks in Plumber routers is the ability to modify the returned value. The convention for such hooks is: any function that accepts a parameter named <code>value</code> is expected to return the new value. This could be an unmodified version of the value that was passed in, or it could be a mutated value. But in either case, if your hook accepts a parameter named <code>value</code>, whatever your hook returns will be used as the new value for the response.</p>
<p>You can add hooks using the <code>registerHook</code> method, or you can add multiple hooks at once using the <code>registerHooks</code> method which takes a name list in which the names are the names of the hooks, and the values are the handlers themselves.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pr &lt;-<span class="st"> </span>plumber$<span class="kw">new</span>()
pr$<span class="kw">registerHook</span>(<span class="st">&quot;preroute&quot;</span>, function(req){
  <span class="kw">cat</span>(<span class="st">&quot;Routing a request for&quot;</span>, req$PATH_INFO, <span class="st">&quot;...</span><span class="ch">\n</span><span class="st">&quot;</span>)
})
pr$<span class="kw">registerHooks</span>(<span class="kw">list</span>(
  <span class="dt">preserialize=</span>function(req, value){
    <span class="kw">print</span>(<span class="st">&quot;About to serialize this value:&quot;</span>)
    <span class="kw">print</span>(value)
    
    <span class="co"># Must return the value since we took one in. Here we&#39;re not choosing</span>
    <span class="co"># to mutate it, but we could.</span>
    value
  },
  <span class="dt">postserialize=</span>function(res){
    <span class="kw">print</span>(<span class="st">&quot;We serialized the value as:&quot;</span>)
    <span class="kw">print</span>(res$body)
  }
))

pr$<span class="kw">handle</span>(<span class="st">&quot;GET&quot;</span>, <span class="st">&quot;/&quot;</span>, function(){ <span class="dv">123</span> })</code></pre></div>
<p>Making a <code>GET</code> request to <code>/</code> will print out various information from the three events for which we registered hooks.</p>
</div>
<div id="mount-static" class="section level2">
<h2><span class="header-section-number">8.5</span> Mounting &amp; Static File Routers</h2>
<p>Plumber routers can be “nested” by mounting one into another using the <code>mount()</code> method. This allows you to compartmentalize your API by paths which is a great technique for decomposing large APIs into smaller files.</p>
<pre><code>root &lt;- plumber$new()

users &lt;- plumber$new(&quot;users.R&quot;)
root$mount(&quot;/users&quot;, users)

products &lt;- plumber$new(&quot;products.R&quot;)
root$mount(&quot;/products&quot;, products)</code></pre>
<p>This is the same approach used for defining routers that serve a directory of static files. Static file routers are just a special case of Plumber routers created using <code>PlumberStatic$new()</code>. For example</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pr &lt;-<span class="st"> </span>plumber$<span class="kw">new</span>()

stat &lt;-<span class="st"> </span>PlumberStatic$<span class="kw">new</span>(<span class="st">&quot;./myfiles&quot;</span>)

pr$<span class="kw">mount</span>(<span class="st">&quot;/assets&quot;</span>, stat)</code></pre></div>
<p>This will make the files and directories stored in the <code>./myfiles</code> directory available on your API under the <code>/assets/</code> path.</p>
</div>
<div id="customize-router" class="section level2">
<h2><span class="header-section-number">8.6</span> Customizing a Router</h2>
<p>There are a handful of useful methods to be aware of to modify the behavior of a router. <a href="#router-hooks">Using hooks to alter request processing</a> has already been discussed, but additionally you can modify a router’s behavior using any of the following:</p>
<ul>
<li><code>setSerializer()</code> - Sets the default serializer of the router.</li>
<li><code>setErrorHandler()</code> - Sets the error handler which gets invoked if any filter or endpoint generates an error.</li>
<li><code>set404Handler()</code> - Sets the handler that gets called if an incoming request can’t be served by any filter, endpoint, or sub-router.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hosting.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tips-tricks.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/trestletech/apis-plumber/edit/master/08-programmatic-usage.Rmd",
"text": "Edit"
},
"download": {},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
